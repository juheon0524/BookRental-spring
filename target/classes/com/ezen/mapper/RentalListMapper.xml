<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ezen.mapper.RentalListMapper">
	
	<!-- com.ezen.domain 패키지에 있는 RentalListVO 클래스를 가리키도록 설정 -->
	<typeAliases>
		<typeAlias alias="RentalListVO"
			type="com.ezen.domain.RentalListVO" />
	</typeAliases>

	<!-- 전체 데이터 조회 -->
	<select id="getList" resultType="RentalListVO">
		SELECT *
		FROM rentallist
	</select>

	<!-- 페이징 처리 -->
	<select id="getListWithPaging" resultType="RentalListVO"
		parameterType="Criterial">
		SELECT *
		FROM rentallist
		ORDER BY rentdate DESC
		LIMIT
		#{startRow}, #{amount}
	</select>

	<!-- rentallistid로 데이터 조회 -->
	<select id="read" resultType="RentalListVO"
		parameterType="String">
		SELECT *
		FROM rentallist
		WHERE rentallistid =
		#{rentallistid}
	</select>

	<!-- rentallistid로 데이터 삭제 -->
	<delete id="delete" parameterType="String">
		DELETE FROM rentallist
		WHERE
		rentallistid = #{rentallistid}
	</delete>

	<!-- 데이터 등록 -->
	<insert id="insert" parameterType="RentalListVO">
		INSERT INTO rentallist
		(rentdate, plannedreturndate, isbn, memberid, subscrlistid,
		actualreturndate,
		deliverydate, deliveryinvno)
		VALUES
		(#{rentdate},
		#{plannedreturndate}, #{isbn}, #{memberid}, #{subscrlistid},
		#{actualreturndate}, #{deliverydate}, #{deliveryinvno})
	</insert>

	<!-- 데이터 수정 -->
	<update id="update" parameterType="RentalListVO">
		UPDATE rentallist
		SET rentdate
		= #{rentdate},
		plannedreturndate = #{plannedreturndate},
		isbn = #{isbn},
		memberid = #{memberid},
		subscrlistid = #{subscrlistid},
		actualreturndate = #{actualreturndate},
		deliverydate = #{deliverydate},
		deliveryinvno = #{deliveryinvno}
		WHERE rentallistid = #{rentallistid}
	</update>

	<!-- 책 보유 수량 여부 확인 -->
	<select id="checkBook" resultType="int" parameterType="String">
		SELECT
		COUNT(*)
		FROM book
		WHERE isbn = #{isbn} AND curbookcnt > 0
	</select>

	<!-- 구독 권 보유 여부 확인 -->
	<select id="checkSub" resultType="int" parameterType="String">
		SELECT
		COUNT(*)
		FROM subscrlist
		WHERE memberid = #{memberid} AND subscrenddate
		> NOW()
	</select>

	<!-- 전체 데이터 수 조회 -->
	<select id="getTotal" resultType="int" parameterType="Criterial">
		SELECT
		COUNT(*)
		FROM rentallist
	</select>
</mapper>